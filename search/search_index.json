{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Ansible Microk8s This documentation walks through setting up a Micok8s cluster on RaspberryPis using Anisble. It assumes you have cloned the git repository and have Ansible installed. What is this repository? This repository is a collection of Ansible playbooks for setting This setup uses the Ubuntu Server 64bit OS. We want 64bit because the docker hub images are limited for 32bit. What is Ansible? Ansible is an open source community project sponsored by Red Hat, it's the simplest way to automate IT. Ansible is the only automation language that can be used across entire IT teams from systems and network administrators to developers and managers. Ansible is the most popular open source automation tool on GitHub today with more than a quarter million downloads per month. How is this repository structured This repository goes through setting up the Ansible user on the node, then configuring the node and finally working with Microk8s References Microk8s Ansible","title":"Home"},{"location":"#ansible-microk8s","text":"This documentation walks through setting up a Micok8s cluster on RaspberryPis using Anisble. It assumes you have cloned the git repository and have Ansible installed.","title":"Ansible Microk8s"},{"location":"#what-is-this-repository","text":"This repository is a collection of Ansible playbooks for setting This setup uses the Ubuntu Server 64bit OS. We want 64bit because the docker hub images are limited for 32bit.","title":"What is this repository?"},{"location":"#what-is-ansible","text":"Ansible is an open source community project sponsored by Red Hat, it's the simplest way to automate IT. Ansible is the only automation language that can be used across entire IT teams from systems and network administrators to developers and managers. Ansible is the most popular open source automation tool on GitHub today with more than a quarter million downloads per month.","title":"What is Ansible?"},{"location":"#how-is-this-repository-structured","text":"This repository goes through setting up the Ansible user on the node, then configuring the node and finally working with Microk8s","title":"How is this repository structured"},{"location":"#references","text":"Microk8s Ansible","title":"References"},{"location":"install/","text":"Microk8s Install Install Microk8s by running the \"02-microk8s.yml\" playbook. ansible-playbook 02-microk8s.yml -i inventory/cluster-1/hosts.ini The playbook will: Install Microk8s Add ansible user to the microk8s group Alias kubectl and helm Copy the .kube/config file to the local user Join all the nodes to the cluster Enable Microk8s addons Copy Kube Config If you have more than one machine you can copy .kube/config file for local kubectl execution with the below SSH copy command scp -i ~/.ssh/ansible ansible@node-1:~/.kube/config ~/.kube/config Install Apps Install kubernetes apps by running the \"03-apps.yml\" playbook ansible-playbook 03-apps.yml -i inventory/cluster-1/hosts.ini The playbook will: Ask what default database username should be. Default is \"root\" Ask what the password for the default username should be. Default is \"password\" Create a Postgres, Mongo and Redis databases with the default username and password. Note: If there are errors creating the apps you may need to create the subfolders \"subPath\" on the NFS server.","title":"Install"},{"location":"install/#microk8s-install","text":"Install Microk8s by running the \"02-microk8s.yml\" playbook. ansible-playbook 02-microk8s.yml -i inventory/cluster-1/hosts.ini The playbook will: Install Microk8s Add ansible user to the microk8s group Alias kubectl and helm Copy the .kube/config file to the local user Join all the nodes to the cluster Enable Microk8s addons","title":"Microk8s Install"},{"location":"install/#copy-kube-config","text":"If you have more than one machine you can copy .kube/config file for local kubectl execution with the below SSH copy command scp -i ~/.ssh/ansible ansible@node-1:~/.kube/config ~/.kube/config","title":"Copy Kube Config"},{"location":"install/#install-apps","text":"Install kubernetes apps by running the \"03-apps.yml\" playbook ansible-playbook 03-apps.yml -i inventory/cluster-1/hosts.ini The playbook will: Ask what default database username should be. Default is \"root\" Ask what the password for the default username should be. Default is \"password\" Create a Postgres, Mongo and Redis databases with the default username and password. Note: If there are errors creating the apps you may need to create the subfolders \"subPath\" on the NFS server.","title":"Install Apps"},{"location":"nodes/","text":"Ubuntu Server Node To config Ubuntu server as a node we run the following playbook, referencing our host.ini file. ansible-playbook 01-node.yml -i inventory/cluster-1/hosts.ini The playbook will Configure the Ubuntu server install Secure SSH login Update and install required apt packages Setup and enable the firewall","title":"Nodes"},{"location":"nodes/#ubuntu-server-node","text":"To config Ubuntu server as a node we run the following playbook, referencing our host.ini file. ansible-playbook 01-node.yml -i inventory/cluster-1/hosts.ini The playbook will Configure the Ubuntu server install Secure SSH login Update and install required apt packages Setup and enable the firewall","title":"Ubuntu Server Node"},{"location":"reset/","text":"Reset Microk8s","title":"Reset"},{"location":"reset/#reset-microk8s","text":"","title":"Reset Microk8s"},{"location":"uninstall/","text":"Uninstall Microk8s","title":"Uninstall"},{"location":"uninstall/#uninstall-microk8s","text":"","title":"Uninstall Microk8s"},{"location":"update/","text":"Update Microk8s Updating you cluster","title":"Update"},{"location":"update/#update-microk8s","text":"Updating you cluster","title":"Update Microk8s"},{"location":"users/","text":"Ansible Update default user password With a fresh install of Ubuntu we need to login to the default account and update the password. ssh ubuntu@<ip-address> Current password: ubuntu New password: <secret-password> Retype new password: <secret-password> Add Ansible user Ubuntu will force exit your ssh session, so you will need to log back in with the password set above. Following add the ansible user. ssh ubuntu@ubuntu sudo adduser --quiet --shell /bin/bash -ingroup sudo ansible exit Generate private/public key If we don't have a generated private/public key, lets go ahead and generate them. ssh-keygen -f ~/.ssh/ansible Copy private key to the node Lets copy the public key so Ansible can login without a password. ssh-copy-id -f -i ~/.ssh/ansible.pub ansible@<ip-address> Add node to our host file If you installed Ansible with Brew host can be added to /usr/local/etc/ansible/hosts. But to keep everything in the repository we can add nodes to the ./inventory/cluster-1/host.ini` file. ansible_host can be set to hostname or IP address if you have assigned static IP address for your nodes. [master] node-1 ansible_host=192.168.1.11 ansible_ssh_private_key_file=~/.ssh/ansible ansible_user=ansible hostname=node-1 [nodes] node-2 ansible_host=192.168.1.12 ansible_ssh_private_key_file=~/.ssh/ansible ansible_user=ansible hostname=node-2 [cluster:children] master nodes Config Users Final step in this stage is to configure the node users. Run the 00-users playbook. This playbook will: Allow ansible user to execute sudo without password Remove ansible account password login Disable default ubuntu password Create and configure a default user Since we haven't configure Ansible to allow sudo without password, we are prompted for Ansible user password and the default user password. The default user is set in `./inventory/cluster-1/group_vars/all.yml ansible-playbook 00-users.yml -i inventory/cluster-1/hosts.ini --ask-become-pass BECOME pass: <ansible-password> Enter default user password: <secret_password> Finish off by copying public key to the node server ssh-copy-id -f -i ~/.ssh/id_rsa.pub <default_user>@<ip-address>","title":"Users"},{"location":"users/#ansible","text":"","title":"Ansible"},{"location":"users/#update-default-user-password","text":"With a fresh install of Ubuntu we need to login to the default account and update the password. ssh ubuntu@<ip-address> Current password: ubuntu New password: <secret-password> Retype new password: <secret-password>","title":"Update default user password"},{"location":"users/#add-ansible-user","text":"Ubuntu will force exit your ssh session, so you will need to log back in with the password set above. Following add the ansible user. ssh ubuntu@ubuntu sudo adduser --quiet --shell /bin/bash -ingroup sudo ansible exit","title":"Add Ansible user"},{"location":"users/#generate-privatepublic-key","text":"If we don't have a generated private/public key, lets go ahead and generate them. ssh-keygen -f ~/.ssh/ansible","title":"Generate private/public key"},{"location":"users/#copy-private-key-to-the-node","text":"Lets copy the public key so Ansible can login without a password. ssh-copy-id -f -i ~/.ssh/ansible.pub ansible@<ip-address>","title":"Copy private key to the node"},{"location":"users/#add-node-to-our-host-file","text":"If you installed Ansible with Brew host can be added to /usr/local/etc/ansible/hosts. But to keep everything in the repository we can add nodes to the ./inventory/cluster-1/host.ini` file. ansible_host can be set to hostname or IP address if you have assigned static IP address for your nodes. [master] node-1 ansible_host=192.168.1.11 ansible_ssh_private_key_file=~/.ssh/ansible ansible_user=ansible hostname=node-1 [nodes] node-2 ansible_host=192.168.1.12 ansible_ssh_private_key_file=~/.ssh/ansible ansible_user=ansible hostname=node-2 [cluster:children] master nodes","title":"Add node to our host file"},{"location":"users/#config-users","text":"Final step in this stage is to configure the node users. Run the 00-users playbook. This playbook will: Allow ansible user to execute sudo without password Remove ansible account password login Disable default ubuntu password Create and configure a default user Since we haven't configure Ansible to allow sudo without password, we are prompted for Ansible user password and the default user password. The default user is set in `./inventory/cluster-1/group_vars/all.yml ansible-playbook 00-users.yml -i inventory/cluster-1/hosts.ini --ask-become-pass BECOME pass: <ansible-password> Enter default user password: <secret_password> Finish off by copying public key to the node server ssh-copy-id -f -i ~/.ssh/id_rsa.pub <default_user>@<ip-address>","title":"Config Users"}]}